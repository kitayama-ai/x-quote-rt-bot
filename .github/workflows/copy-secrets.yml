name: "Run Mini Tool Test"

on:
  workflow_dispatch:
    inputs:
      mode:
        description: "テストモード"
        required: true
        default: "post-test"
        type: choice
        options:
          - post-test
          - collect-only
          - dry-run
          - full-auto

jobs:
  test-mini:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout mini repo
        uses: actions/checkout@v4
        with:
          repository: kitayama-ai/x-quote-rt-mini
          ref: main

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run mini tool
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCOUNT_1_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCOUNT_1_ACCESS_SECRET }}
          TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          case "${{ github.event.inputs.mode }}" in
            post-test)
              python run.py --post-test
              ;;
            collect-only)
              python run.py --collect --min-likes 100
              ;;
            dry-run)
              python run.py --dry-run --auto --min-likes 100
              ;;
            full-auto)
              python run.py --auto --min-likes 100
              ;;
          esac
